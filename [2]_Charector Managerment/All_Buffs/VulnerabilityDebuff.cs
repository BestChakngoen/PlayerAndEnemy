using UnityEngine;
using UnityEngine.AI;
using PlayerInputs;

namespace BasicEnemy
{
    public class VulnerabilityDebuff : Buff
    {
        private VulnerabilityDebuffData data;
        private PlayerMovementController player;
        private float originalPlayerSpeed;
        private GameObject vfxInstance;

        public VulnerabilityDebuff(VulnerabilityDebuffData data) : base(data.duration)
        {
            this.data = data;
        }

        public override void OnApply(GameObject target)
        {
            base.OnApply(target);
            
            player = target.GetComponent<PlayerMovementController>();
            if (player != null)
            {
                originalPlayerSpeed = player.moveSpeed; 
                player.moveSpeed *= (1f - data.slowAmount);
                return; 
            }
            if (data.debuffVFXPrefab != null)
            {
                vfxInstance = Object.Instantiate(data.debuffVFXPrefab, target.transform);
                Debug.Log("ddfs");
            }

        }
        
        public override float ModifyIncomingDamage(float damage)
        {
            return damage * (1f + data.damageIncrease);
        }

        public override void OnExpire()
        {
            base.OnExpire();
            
            if (player != null)
            {
                player.moveSpeed = originalPlayerSpeed;
            }
            if (vfxInstance != null)
            {
                Object.Destroy(vfxInstance);
            }

        }
    }
}